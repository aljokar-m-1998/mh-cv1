<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Pro - صانع السيرة الذاتية الاحترافي</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Tajawal:wght@300;400;500;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* Light Theme */
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --bg-editor: #f8fafc;
            --bg-panel: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --sidebar-width: 420px;
        }

        /* Dark Mode Configuration */
        .dark-mode {
            --primary: #60a5fa;
            --primary-dark: #3b82f6;
            --bg-editor: #1f2937;
            --bg-panel: #374151;
            --text-main: #f3f4f6;
            --text-muted: #d1d5db;
            --border: #4b5563;
        }
        
        /* --- Global Reset --- */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { 
            font-family: 'Tajawal', 'Inter', sans-serif; 
            background: #525659; /* خلفية داكنة للتركيز على الورقة */
            height: 100vh; 
            overflow: hidden; 
            color: var(--text-main);
            transition: background 0.3s, color 0.3s; /* Smooth transition for dark mode */
        }

        /* --- Dark Mode Styles --- */
        .dark-mode body {
            background: #222;
        }
        .dark-mode .editor-sidebar {
            box-shadow: -4px 0 20px rgba(0,0,0,0.5);
        }
        .dark-mode .sidebar-header {
            background: var(--bg-panel);
        }
        .dark-mode .btn-ghost { 
            background: #4b5563; 
            color: var(--text-muted); 
        }
        .dark-mode .btn-ghost:hover { 
            background: #6b7280; 
            color: var(--text-main); 
        }
        .dark-mode .tabs-nav { 
            background: #4b5563; 
        }
        .dark-mode .tab-btn.active { 
            background: var(--bg-panel); 
            color: var(--primary); 
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .dark-mode .input-control { 
            background: #4b5563; 
            border-color: #6b7280;
            color: var(--text-main);
        }
        .dark-mode .input-control:focus { 
            border-color: var(--primary); 
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }
        .dark-mode .list-item { 
            background: #4b5563; 
            border-color: #6b7280;
        }
        .dark-mode .remove-item {
            background: var(--bg-panel);
            border-color: #fca5a5;
        }
        .dark-mode .btn-add-item {
            border-color: #6b7280;
            color: var(--text-muted);
        }
        .dark-mode .btn-add-item:hover { 
            border-color: var(--primary); 
            color: var(--primary); 
            background: #374151;
        }
        .dark-mode .sidebar-header + div {
            border-top-color: var(--border);
        }
        .dark-mode .toggle-header {
            background: #4b5563;
        }
        .dark-mode .toggle-content {
            background: #4b5563;
        }
        /* --- Layout --- */
        .app-container { display: flex; height: 100vh; }

        /* --- Editor Sidebar (Right Side) --- */
        .editor-sidebar {
            width: var(--sidebar-width);
            background: var(--bg-panel);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 20;
            box-shadow: -4px 0 20px rgba(0,0,0,0.05);
            height: 100vh;
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-panel);
            transition: background 0.3s, border-color 0.3s;
        }

        .logo { font-weight: 800; font-size: 1.2rem; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        .action-btns { display: flex; gap: 8px; }
        .btn { border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-family: inherit; transition: 0.2s; font-weight: 500; }
        .btn-ghost { background: #f1f5f9; color: var(--text-muted); }
        .btn-ghost:hover { background: #e2e8f0; color: var(--text-main); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-download { background: #10b981; color: white; width: 100%; padding: 14px; margin-top: 10px; display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; border: none; border-radius: 6px;}
        .btn-download:hover { background: #059669; }
        
        /* New: Settings Button - Removed as separate button */
        /* .btn-settings { width: 38px; padding: 8px; } */


        .sidebar-content { flex: 1; overflow-y: auto; padding: 20px; }

        /* Tabs Navigation */
        .tabs-nav { display: flex; background: #f1f5f9; padding: 4px; border-radius: 8px; margin-bottom: 25px; }
        .tab-btn { flex: 1; padding: 8px; text-align: center; cursor: pointer; border-radius: 6px; font-size: 0.85rem; color: var(--text-muted); transition: 0.2s; white-space: nowrap; }
        .tab-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-weight: bold; }

        /* Forms */
        .section-title { font-size: 1rem; font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; color: var(--text-main); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.85rem; color: var(--text-muted); font-weight: 500; }
        .input-control { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 6px; font-family: inherit; font-size: 0.9rem; transition: 0.2s; background: #fff; }
        .input-control:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        textarea.input-control { resize: vertical; min-height: 80px; }
        
        /* Settings Toggle Group */
        .setting-toggle-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .setting-toggle-group:last-of-type { border-bottom: none; }
        
        .switch { position: relative; display: inline-block; width: 48px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: 0.4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* NEW: About Section as Toggle/Accordion */
        .about-toggle {
            margin-top: 25px;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }
        .toggle-header {
            padding: 15px;
            background: var(--bg-editor);
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        .toggle-header:hover {
            background: var(--border);
        }
        .toggle-header i {
            transition: transform 0.3s;
        }
        .toggle-header.open i {
            transform: rotate(180deg);
        }
        .toggle-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, padding 0.3s;
            background: var(--bg-editor);
            padding: 0 15px;
        }
        .toggle-content.open {
            max-height: 500px; /* Large enough for content */
            padding: 15px;
            border-top: 1px solid var(--border);
        }
        .about-text-content {
            font-size: 0.9rem;
            line-height: 1.7;
            text-align: center;
            color: var(--text-muted);
        }
        .about-text-content p {
            margin-bottom: 10px;
        }
        .about-text-content h4 {
            font-size: 1rem;
            color: var(--text-main);
            margin-bottom: 8px;
        }

        /* Template Grid */
        .template-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .tmpl-card { border: 2px solid var(--border); border-radius: 8px; overflow: hidden; cursor: pointer; transition: 0.2s; }
        .tmpl-card img { width: 100%; height: 80px; object-fit: cover; background: #eee; display: block; }
        .tmpl-card .name { padding: 8px; font-size: 0.8rem; text-align: center; font-weight: 600; background: #fff; }
        .tmpl-card.active { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2); }
        .tmpl-card.active .name { color: var(--primary); }
        .dark-mode .tmpl-card .name { background: var(--bg-panel); }

        /* List Items */
        .list-item { background: #f8fafc; border: 1px solid var(--border); border-radius: 8px; padding: 15px; margin-bottom: 12px; position: relative; }
        .remove-item { position: absolute; top: 10px; left: 10px; color: #ef4444; cursor: pointer; background: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid #fee2e2; }
        .btn-add-item { width: 100%; padding: 12px; border: 2px dashed #cbd5e1; background: transparent; border-radius: 8px; color: var(--text-muted); cursor: pointer; font-weight: 600; }
        .btn-add-item:hover { border-color: var(--primary); color: var(--primary); background: #eff6ff; }

        /* --- Preview Area (Left Side) --- */
        .preview-area {
            flex: 1;
            overflow: auto;
            display: flex;
            justify-content: center;
            padding: 40px 20px;
            background: #525659;
        }

        /* ================================================================
           CRITICAL: PAPER DIMENSIONS & PRINT SETTINGS
           ================================================================
        */
        .cv-paper {
            background: white;
            /* A4 Standard Dimensions */
            width: 210mm;
            min-height: 297mm;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
        }

        /* Print Styles - The Fix for Full Page */
        @media print {
            @page {
                margin: 0; /* Important: Kill browser margins */
                size: A4;  /* Explicitly tell printer it's A4 */
            }
            
            body, html {
                margin: 0;
                padding: 0;
                width: 100%;
                background: white;
                height: 100%;
            }

            .app-container { display: block; height: auto; }
            .editor-sidebar { display: none !important; }
            .preview-area { 
                padding: 0; 
                margin: 0; 
                overflow: visible; 
                display: block; 
                background: white; 
                height: auto;
            }

            .cv-paper {
                width: 100%; /* Fill the print width */
                max-width: 210mm; /* Ensure it doesn't overflow horizontally */
                min-height: 297mm; /* Full height */
                margin: 0 auto;
                box-shadow: none;
                border: none;
                /* Force Print Colors */
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                page-break-after: always;
            }

            /* Adjust internal padding for print to ensure content isn't cut off */
            .tmpl-modern .sidebar-col { padding: 25px !important; }
            .tmpl-modern .main-col { padding: 30px !important; }
            .tmpl-classic { padding: 40px !important; }
            .tmpl-creative .cv-content { padding: 30px !important; }
        }

        /* ================== TEMPLATES STYLES (No change here) ================== */
        
        /* تم تعديل حجم الخط الأساسي ليكون 15px */
        .cv-content { height: 100%; color: #333; line-height: 1.5; font-size: 15px; } 
        
        /* 1. Modern Clean */
        .tmpl-modern .cv-content { display: grid; grid-template-columns: 32% 68%; min-height: 297mm; }
        .tmpl-modern .sidebar-col { background: var(--theme-color); color: white; padding: 30px; }
        .tmpl-modern[dir="rtl"] .sidebar-col { text-align: right; }
        .tmpl-modern .main-col { padding: 40px 35px; background: white; }
        
        .tmpl-modern .profile-img { width: 140px; height: 140px; border-radius: 50%; border: 4px solid rgba(255,255,255,0.2); margin-bottom: 25px; display: block; object-fit: cover; }
        .tmpl-modern h2 { font-size: 1.1rem; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 8px; margin: 25px 0 15px; letter-spacing: 1px; }
        .tmpl-modern .contact-info div { margin-bottom: 10px; display: flex; align-items: center; gap: 10px; font-size: 0.9rem; word-break: break-word; }
        
        .tmpl-modern .main-header { margin-bottom: 30px; border-bottom: 2px solid #f1f1f1; padding-bottom: 20px; }
        /* تم تعديل حجم الخط الرئيسي H1 */
        .tmpl-modern h1 { font-size: 2.8rem; text-transform: uppercase; color: #222; margin-bottom: 5px; line-height: 1.1; font-weight: 800; }
        .tmpl-modern .job-title { font-size: 1.2rem; color: var(--theme-color); font-weight: 600; letter-spacing: 1px; }
        
        /* تم تعديل حجم خط العناوين الفرعية */
        .tmpl-modern .section-head { font-size: 1.4rem; color: var(--theme-color); border-bottom: 2px solid #eee; padding-bottom: 8px; margin: 25px 0 15px; font-weight: 700; text-transform: uppercase; display: flex; align-items: center; gap: 10px; }
        .tmpl-modern .entry { margin-bottom: 18px; }
        .tmpl-modern .entry-title { font-weight: 700; font-size: 1.1rem; color: #1f2937; }
        .tmpl-modern .entry-sub { font-weight: 600; color: #555; font-size: 0.95rem; margin-bottom: 4px; display: flex; justify-content: space-between; }
        .tmpl-modern p { color: #4b5563; font-size: 0.95rem; text-align: justify; }

        /* 2. Professional Classic */
        .tmpl-classic { padding: 45px 50px; }
        .tmpl-classic .header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid #ddd; padding-bottom: 25px; }
        /* تم تعديل حجم خط H1 */
        .tmpl-classic h1 { font-family: 'Playfair Display', serif; font-size: 3.2rem; color: var(--theme-color); margin-bottom: 5px; }
        .tmpl-classic .job-title { font-size: 1.2rem; color: #555; margin-bottom: 12px; letter-spacing: 1px; text-transform: uppercase; }
        .tmpl-classic .contacts { display: flex; justify-content: center; gap: 15px; color: #666; font-size: 0.9rem; flex-wrap: wrap; }
        
        .tmpl-classic h3 { font-size: 1.2rem; text-transform: uppercase; border-bottom: 2px solid var(--theme-color); padding-bottom: 5px; margin: 20px 0 15px; color: var(--theme-color); letter-spacing: 1px; }
        .tmpl-classic .entry { display: grid; grid-template-columns: 140px 1fr; gap: 20px; margin-bottom: 20px; }
        .tmpl-classic .date-col { font-weight: 600; color: #777; font-size: 0.9rem; text-align: right; padding-top: 2px; }
        .tmpl-classic[dir="ltr"] .date-col { text-align: right; }
        .tmpl-classic[dir="rtl"] .date-col { text-align: left; }
        
        .tmpl-classic .main-col h4 { font-size: 1.1rem; font-weight: 700; margin-bottom: 2px; color: #111; }
        .tmpl-classic .main-col .sub { font-style: italic; color: #555; margin-bottom: 6px; font-size: 0.95rem; }

        /* 3. Creative */
        .tmpl-creative .cv-content { padding: 40px; border-top: 15px solid var(--theme-color); background: white; min-height: 297mm; }
        .tmpl-creative .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 40px; }
        /* تم تعديل حجم خط H1 */
        .tmpl-creative h1 { font-size: 3.4rem; line-height: 1; margin-bottom: 10px; color: #111; font-weight: 800; }
        .tmpl-creative .job-title { font-size: 1.3rem; background: var(--theme-color); color: white; display: inline-block; padding: 6px 16px; transform: skew(-10deg); }
        .tmpl-creative .contacts { text-align: right; font-size: 0.9rem; line-height: 1.8; color: #444; }
        .tmpl-creative[dir="rtl"] .contacts { text-align: left; }
        
        .tmpl-creative .grid-layout { display: grid; grid-template-columns: 68% 28%; gap: 4%; }
        /* تم تعديل حجم خط العناوين الفرعية */
        .tmpl-creative h3 { font-size: 1.4rem; font-weight: 800; margin: 0 0 20px; text-transform: uppercase; letter-spacing: 1px; position: relative; display: inline-block; color: #333; }
        .tmpl-creative h3::after { content: ''; position: absolute; width: 100%; height: 4px; background: var(--theme-color); bottom: -6px; left: 0; opacity: 0.4; }
        
        .skill-bar { margin-bottom: 12px; }
        .skill-name { font-weight: 600; font-size: 0.9rem; margin-bottom: 4px; }
        .bar-bg { background: #eee; height: 6px; width: 100%; border-radius: 3px; }
        .bar-fill { background: var(--theme-color); height: 100%; border-radius: 3px; width: 85%; }

        /* Mobile Responsive */
        @media (max-width: 900px) {
            .app-container { flex-direction: column-reverse; }
            .editor-sidebar { width: 100%; height: 50vh; border-left: none; border-top: 1px solid var(--border); }
            .preview-area { height: 50vh; align-items: flex-start; padding: 10px; }
            .cv-paper { 
                /* تم إزالة transform: scale(0.5); */
                width: 100%;
                max-width: 210mm;
                margin: 0 auto;
                transform-origin: top center; 
                margin-bottom: 0; 
            }
        }
    </style>
</head>
<body id="app-body">

    <div class="app-container">
        
        <main class="preview-area">
            <div id="cv-paper" class="cv-paper tmpl-modern" dir="rtl">
                </div>
        </main>

        <aside class="editor-sidebar">
            <div class="sidebar-header">
                <div class="logo"><i class="fas fa-file-signature"></i> CV Pro</div>
                <div class="action-btns">
                    <button class="btn btn-ghost" onclick="resetData()" title="مسح البيانات"><i class="fas fa-trash-alt"></i></button>
                    <button class="btn btn-ghost" onclick="loadSample()" title="مثال جاهز"><i class="fas fa-magic"></i></button>
                </div>
            </div>

            <div class="sidebar-content">
                <div class="tabs-nav">
                    <div class="tab-btn active" onclick="switchTab('design')">التصميم</div>
                    <div class="tab-btn" onclick="switchTab('info')">البيانات</div>
                    <div class="tab-btn" onclick="switchTab('exp')">الخبرات</div>
                    <div class="tab-btn" onclick="switchTab('skills')">المهارات</div>
                    <div class="tab-btn" onclick="switchTab('settings')">الإعدادات</div>
                </div>

                <div id="tab-design" class="tab-pane">
                    <div class="form-group">
                        <label id="label-color">لون القالب / Theme Color</label>
                        <input type="color" class="input-control" value="#2563eb" style="height: 45px; padding: 5px;" oninput="updateConfig('color', this.value)">
                    </div>
                    <div class="form-group">
                        <label id="label-template">اختر القالب / Select Template</label>
                        <div class="template-grid">
                            <div class="tmpl-card active" onclick="setTemplate('tmpl-modern')" id="card-tmpl-modern">
                                <div style="height:80px; background:linear-gradient(135deg, #2563eb 30%, #fff 30%);"></div>
                                <div class="name" id="name-modern">عصري / Modern</div>
                            </div>
                            <div class="tmpl-card" onclick="setTemplate('tmpl-classic')" id="card-tmpl-classic">
                                <div style="height:80px; background:#fff; border-bottom:4px solid #333; display:flex; justify-content:center; align-items:center; font-family:serif; font-weight:bold; font-size:20px;">CV</div>
                                <div class="name" id="name-classic">كلاسيكي / Classic</div>
                            </div>
                            <div class="tmpl-card" onclick="setTemplate('tmpl-creative')" id="card-tmpl-creative">
                                <div style="height:80px; background:white; border-top:10px solid #e11d48; display:flex; align-items:center; padding:10px;">
                                    <div style="width:20px; height:20px; background:#e11d48; border-radius:50%;"></div>
                                </div>
                                <div class="name" id="name-creative">إبداعي / Creative</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-info" class="tab-pane" style="display:none;">
                    <div class="form-group">
                        <label id="label-photo">الصورة الشخصية</label>
                        <input type="file" class="input-control" accept="image/*" onchange="handleImageUpload(this)">
                    </div>
                    <div class="form-group">
                        <label id="label-name">الاسم الكامل</label>
                        <input type="text" class="input-control" data-model="name" placeholder="أحمد محمد..." oninput="updateData(this)">
                    </div>
                    <div class="form-group">
                        <label id="label-jobTitle">المسمى الوظيفي</label>
                        <input type="text" class="input-control" data-model="jobTitle" placeholder="مهندس برمجيات..." oninput="updateData(this)">
                    </div>
                    <div class="form-group">
                        <label id="label-email">البريد الإلكتروني</label>
                        <input type="text" class="input-control" data-model="email" oninput="updateData(this)">
                    </div>
                    <div class="form-group">
                        <label id="label-phone">رقم الهاتف</label>
                        <input type="text" class="input-control" data-model="phone" oninput="updateData(this)">
                    </div>
                    <div class="form-group">
                        <label id="label-address">العنوان</label>
                        <input type="text" class="input-control" data-model="address" oninput="updateData(this)">
                    </div>
                    <div class="form-group">
                        <label id="label-summary">ملخص شخصي</label>
                        <textarea class="input-control" data-model="summary" oninput="updateData(this)"></textarea>
                    </div>
                </div>

                <div id="tab-exp" class="tab-pane" style="display:none;">
                    <div class="section-title" id="title-exp"><i class="fas fa-briefcase"></i> خبرات العمل</div>
                    <div id="exp-list-container"></div>
                    <button class="btn-add-item" id="btn-add-exp" onclick="addItem('experience')">+ إضافة خبرة عمل</button>

                    <hr style="margin: 25px 0; border: 0; border-top: 1px solid var(--border);">

                    <div class="section-title" id="title-edu"><i class="fas fa-graduation-cap"></i> التعليم</div>
                    <div id="edu-list-container"></div>
                    <button class="btn-add-item" id="btn-add-edu" onclick="addItem('education')">+ إضافة مؤهل علمي</button>
                </div>

                <div id="tab-skills" class="tab-pane" style="display:none;">
                    <div class="form-group">
                        <label id="label-skills">اكتب المهارات (افصل بينها بفاصلة)</label>
                        <textarea class="input-control" data-model="skills" placeholder="HTML, CSS, Photoshop..." style="height:120px;" oninput="updateData(this)"></textarea>
                    </div>
                </div>

                <div id="tab-settings" class="tab-pane" style="display:none;">
                    <div class="section-title"><i class="fas fa-cogs"></i> <span id="settings-title">الإعدادات</span></div>
                    
                    <div class="setting-toggle-group">
                        <label id="label-lang-switch">لغة الواجهة / Interface Language</label>
                        <select class="input-control" id="langSelect" style="width:150px;" onchange="updateConfig('lang', this.value); updateInterfaceText(this.value)">
                            <option value="ar">العربية (RTL)</option>
                            <option value="en">English (LTR)</option>
                        </select>
                    </div>

                    <div class="setting-toggle-group">
                        <label id="label-dark-mode">الوضع المظلم / Dark Mode</label>
                        <label class="switch">
                            <input type="checkbox" id="darkModeSwitch" onchange="toggleDarkMode(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="about-toggle">
                        <div class="toggle-header" id="about-header" onclick="toggleAboutSection()">
                            <span id="about-title"><i class="fas fa-info-circle"></i> حول التطبيق</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="toggle-content" id="about-content">
                            <div class="about-text-content">
                                <h4 id="about-app-name">CV Pro - صانع السيرة الذاتية الاحترافي</h4>
                                <p id="about-text-intro">نحن نؤمن بأن سيرتك الذاتية هي مفتاحك نحو المستقبل. هذا التطبيق مصمم لمساعدتك في إنشاء سيرة ذاتية احترافية وجذابة في دقائق معدودة، بألوان وتصاميم عصرية ومناسبة.</p>
                                <p id="about-text-focus" style="color:var(--primary);">ركز على المحتوى، واترك لنا مهمة التنسيق والاحترافية.</p>
                                <p id="about-dev" style="font-weight:700; color:var(--primary); margin-top:10px;">تصميم وتطوير MAHMOUD HASSAN</p>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

            <div style="padding: 20px; background: var(--bg-panel); border-top: 1px solid var(--border); transition: background 0.3s, border-color 0.3s;">
                <button class="btn btn-download" onclick="downloadPDF()">
                    <i class="fas fa-file-pdf"></i> <span id="btn-download-text">تحميل PDF (طباعة)</span>
                </button>
            </div>
        </aside>
    </div>

    <script>
        // --- Translations (Language Strings) ---
        const translations = {
            ar: {
                // UI Elements
                'tab-design': 'التصميم', 'tab-info': 'البيانات', 'tab-exp': 'الخبرات', 'tab-skills': 'المهارات', 'tab-settings': 'الإعدادات',
                'btn-download-text': 'تحميل PDF (طباعة)', 'title-exp': 'خبرات العمل', 'title-edu': 'التعليم',
                'btn-add-exp': '+ إضافة خبرة عمل', 'btn-add-edu': '+ إضافة مؤهل علمي',
                'label-color': 'لون القالب / Theme Color', 'label-template': 'اختر القالب / Select Template',
                'name-modern': 'عصري / Modern', 'name-classic': 'كلاسيكي / Classic', 'name-creative': 'إبداعي / Creative',
                
                // Form Labels
                'label-photo': 'الصورة الشخصية', 'label-name': 'الاسم الكامل', 'label-jobTitle': 'المسمى الوظيفي',
                'label-email': 'البريد الإلكتروني', 'label-phone': 'رقم الهاتف', 'label-address': 'العنوان',
                'label-summary': 'ملخص شخصي', 'label-skills': 'اكتب المهارات (افصل بينها بفاصلة)',

                // Settings
                'settings-title': 'الإعدادات', 'label-lang-switch': 'لغة الواجهة / Interface Language', 
                'label-dark-mode': 'الوضع المظلم / Dark Mode', 'about-title': 'حول التطبيق',
                'about-app-name': 'CV Pro - صانع السيرة الذاتية الاحترافي',
                'about-text-intro': 'نحن نؤمن بأن سيرتك الذاتية هي مفتاحك نحو المستقبل. هذا التطبيق مصمم لمساعدتك في إنشاء سيرة ذاتية احترافية وجذابة في دقائق معدودة، بألوان وتصاميم عصرية ومناسبة.',
                'about-text-focus': 'ركز على المحتوى، واترك لنا مهمة التنسيق والاحترافية.',
                'about-dev': 'تصميم وتطوير MAHMOUD HASSAN',
                
                // CV Labels
                cv_contact: 'معلومات الاتصال', cv_skills: 'المهارات', cv_profile: 'نبذة عني', cv_exp: 'الخبرات العملية', cv_edu: 'المؤهلات العلمية',
                // Item Placeholders
                ph_exp_title: 'المسمى الوظيفي', ph_edu_title: 'الدرجة العلمية',
                ph_exp_subtitle: 'الشركة', ph_edu_subtitle: 'الجامعة',
                ph_date: 'التاريخ', ph_desc: 'الوصف',
                
                // Header Buttons
                btn_reset: 'مسح البيانات', btn_sample: 'مثال جاهز', btn_settings: 'الإعدادات'
            },
            en: {
                // UI Elements
                'tab-design': 'Design', 'tab-info': 'Data', 'tab-exp': 'Experience', 'tab-skills': 'Skills', 'tab-settings': 'Settings',
                'btn-download-text': 'Download PDF (Print)', 'title-exp': 'Work Experience', 'title-edu': 'Education',
                'btn-add-exp': '+ Add Work Experience', 'btn-add-edu': '+ Add Qualification',
                'label-color': 'Theme Color', 'label-template': 'Select Template',
                'name-modern': 'Modern', 'name-classic': 'Classic', 'name-creative': 'Creative',

                // Form Labels
                'label-photo': 'Personal Photo', 'label-name': 'Full Name', 'label-jobTitle': 'Job Title',
                'label-email': 'Email', 'label-phone': 'Phone Number', 'label-address': 'Address',
                'label-summary': 'Personal Summary', 'label-skills': 'Enter Skills (Comma Separated)',

                // Settings
                'settings-title': 'Settings', 'label-lang-switch': 'Interface Language', 
                'label-dark-mode': 'Dark Mode', 'about-title': 'About App',
                'about-app-name': 'CV Pro - Professional CV Builder',
                'about-text-intro': 'We believe your CV is the key to your future. This app is designed to help you create an attractive and professional CV in minutes, with modern colors and layouts.',
                'about-text-focus': 'Focus on the content, and leave the formatting and professionalism to us.',
                'about-dev': 'Designed & Developed by MAHMOUD HASSAN',

                // CV Labels
                cv_contact: 'Contact Info', cv_skills: 'Skills', cv_profile: 'Profile', cv_exp: 'Experience', cv_edu: 'Education',
                // Item Placeholders
                ph_exp_title: 'Job Title', ph_edu_title: 'Degree/Certificate',
                ph_exp_subtitle: 'Company', ph_edu_subtitle: 'University/Institute',
                ph_date: 'Date/Duration', ph_desc: 'Description',

                // Header Buttons
                btn_reset: 'Clear Data', btn_sample: 'Load Sample', btn_settings: 'Settings'
            }
        };

        // --- State Management ---
        const defaultState = {
            config: {
                lang: 'ar',
                color: '#2563eb',
                template: 'tmpl-modern',
                darkMode: false
            },
            data: {
                name: '',
                jobTitle: '',
                email: '',
                phone: '',
                address: '',
                summary: '',
                photo: null,
                skills: '',
                experience: [],
                education: []
            }
        };

        let state = JSON.parse(JSON.stringify(defaultState));
        
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('cv_builder_v2_state');
            if(saved) state = JSON.parse(saved);
            renderAll();
            // Ensure interface is set to initial/saved language
            updateInterfaceText(state.config.lang);
            // Apply dark mode immediately
            if (state.config.darkMode) {
                document.getElementById('darkModeSwitch').checked = true;
                document.getElementById('app-body').classList.add('dark-mode');
            }
        });

        // --- Logic ---
        function updateConfig(key, value) {
            state.config[key] = value;
            saveAndRender();
        }

        // NEW: Dark Mode Toggle
        function toggleDarkMode(isDark) {
            state.config.darkMode = isDark;
            document.getElementById('app-body').classList.toggle('dark-mode', isDark);
            saveAndRender();
        }

        // NEW: About Section Toggle
        function toggleAboutSection() {
            const content = document.getElementById('about-content');
            const header = document.getElementById('about-header');
            
            content.classList.toggle('open');
            header.classList.toggle('open');
        }

        // NEW: Interface Text Update Function
        function updateInterfaceText(lang) {
            const t = translations[lang];
            
            // Set body/app direction
            document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
            document.body.style.fontFamily = lang === 'ar' ? "'Tajawal', 'Inter', sans-serif" : "'Inter', 'Tajawal', sans-serif";
            
            // Update Tab Buttons
            document.querySelectorAll('.tabs-nav .tab-btn').forEach(btn => {
                const tabText = btn.innerText.toLowerCase();
                let tabId;

                if (tabText.includes('design') || tabText.includes('التصميم')) tabId = 'design';
                else if (tabText.includes('data') || tabText.includes('البيانات')) tabId = 'info';
                else if (tabText.includes('exp') || tabText.includes('الخبرات')) tabId = 'exp';
                else if (tabText.includes('skills') || tabText.includes('المهارات')) tabId = 'skills';
                else if (tabText.includes('settings') || tabText.includes('الإعدادات')) tabId = 'settings';
                
                if (tabId) btn.innerText = t[`tab-${tabId}`];
            });

            // Update UI Elements by ID (Use innerHTML for icons)
            const uiElements = {
                'btn-download-text': t['btn-download-text'],
                'title-exp': `<i class="fas fa-briefcase"></i> ${t['title-exp']}`, 
                'title-edu': `<i class="fas fa-graduation-cap"></i> ${t['title-edu']}`, 
                'btn-add-exp': t['btn-add-exp'], 
                'btn-add-edu': t['btn-add-edu'], 
                'settings-title': t['settings-title'], 
                'about-title': `<i class="fas fa-info-circle"></i> ${t['about-title']}`,
                'about-app-name': t['about-app-name'],
                'about-text-intro': t['about-text-intro'],
                'about-text-focus': t['about-text-focus'],
                'about-dev': t['about-dev']
            };
            
            for (const id in uiElements) {
                const el = document.getElementById(id);
                if (el) el.innerHTML = uiElements[id];
            }

            // Update Form Labels
            const labelElements = ['label-color', 'label-template', 'label-photo', 'label-name', 'label-jobTitle', 'label-email', 'label-phone', 'label-address', 'label-summary', 'label-skills', 'label-lang-switch', 'label-dark-mode'];
            labelElements.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerText = t[id];
            });
            
            // Update Template Names
            document.getElementById('name-modern').innerText = t['name-modern'];
            document.getElementById('name-classic').innerText = t['name-classic'];
            document.getElementById('name-creative').innerText = t['name-creative'];
            
            // Update Header Buttons tooltips
            document.querySelector('[onclick="resetData()"]').title = t.btn_reset;
            document.querySelector('[onclick="loadSample()"]').title = t.btn_sample;

            // Re-render form lists for item placeholders
            renderFormLists();
            
            // Re-render CV preview
            renderPreview();
        }


        function setTemplate(tmplName) {
            state.config.template = tmplName;
            document.querySelectorAll('.tmpl-card').forEach(el => el.classList.remove('active'));
            document.getElementById(`card-${tmplName}`).classList.add('active');
            saveAndRender();
        }

        function updateData(input) {
            const key = input.dataset.model;
            state.data[key] = input.value;
            saveAndRender();
        }

        function handleImageUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    state.data.photo = e.target.result;
                    saveAndRender();
                };
                reader.readAsDataURL(file);
            }
        }

        function addItem(type) {
            const id = Date.now();
            state.data[type].push({ id, title: '', subtitle: '', date: '', desc: '' });
            renderFormLists();
            saveAndRender();
        }

        function removeItem(type, id) {
            state.data[type] = state.data[type].filter(item => item.id !== id);
            renderFormLists();
            saveAndRender();
        }

        function updateItem(type, id, key, value) {
            const item = state.data[type].find(i => i.id === id);
            if(item) {
                item[key] = value;
                saveAndRender();
            }
        }

        function saveAndRender() {
            localStorage.setItem('cv_builder_v2_state', JSON.stringify(state));
            renderPreview();
        }

        function renderAll() {
            document.querySelectorAll('[data-model]').forEach(input => {
                const key = input.dataset.model;
                if(state.data[key] !== undefined) input.value = state.data[key];
            });
            document.getElementById('langSelect').value = state.config.lang;
            document.querySelector('input[type="color"]').value = state.config.color;
            document.getElementById('darkModeSwitch').checked = state.config.darkMode;
            setTemplate(state.config.template);
            renderFormLists();
        }

        function renderFormLists() {
            const t = translations[state.config.lang];

            ['experience', 'education'].forEach(type => {
                const container = document.getElementById(`${type === 'experience' ? 'exp' : 'edu'}-list-container`);
                container.innerHTML = '';
                state.data[type].forEach(item => {
                    const titlePlaceholder = t[type === 'experience' ? 'ph_exp_title' : 'ph_edu_title'];
                    const subtitlePlaceholder = t[type === 'experience' ? 'ph_exp_subtitle' : 'ph_edu_subtitle'];
                    
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.innerHTML = `
                        <div class="remove-item" onclick="removeItem('${type}', ${item.id})"><i class="fas fa-times"></i></div>
                        <div class="form-group">
                            <input type="text" class="input-control" placeholder="${titlePlaceholder}" 
                                value="${item.title}" oninput="updateItem('${type}', ${item.id}, 'title', this.value)">
                        </div>
                        <div class="form-group" style="display:flex; gap:10px;">
                            <input type="text" class="input-control" placeholder="${subtitlePlaceholder}" 
                                value="${item.subtitle}" oninput="updateItem('${type}', ${item.id}, 'subtitle', this.value)">
                            <input type="text" class="input-control" placeholder="${t.ph_date}" 
                                value="${item.date}" oninput="updateItem('${type}', ${item.id}, 'date', this.value)">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <textarea class="input-control" placeholder="${t.ph_desc}" style="min-height:60px;"
                                oninput="updateItem('${type}', ${item.id}, 'desc', this.value)">${item.desc}</textarea>
                        </div>
                    `;
                    container.appendChild(div);
                });
            });
        }

        function renderPreview() {
            const cv = document.getElementById('cv-paper');
            const { config, data } = state;
            const t = translations[config.lang];
            
            cv.className = `cv-paper ${config.template}`;
            cv.setAttribute('dir', config.lang === 'ar' ? 'rtl' : 'ltr');
            cv.style.setProperty('--theme-color', config.color);
            
            const labels = { 
                contact: t.cv_contact, 
                skills: t.cv_skills, 
                profile: t.cv_profile, 
                exp: t.cv_exp, 
                edu: t.cv_edu 
            };

            const photoHTML = data.photo ? `<img src="${data.photo}" class="profile-img cv-photo">` : '';
            const skillsHTML = data.skills.split(/,|\n/).filter(s=>s.trim()).map(s => 
                config.template === 'tmpl-creative' 
                ? `<div class="skill-bar"><div class="skill-name">${s.trim()}</div><div class="bar-bg"><div class="bar-fill"></div></div></div>`
                : `<span style="display:inline-block; background:#eee; padding:4px 10px; border-radius:4px; margin:3px; font-size:0.85rem; font-weight:500;">${s.trim()}</span>`
            ).join('');

            // --- Templates HTML ---
            if (config.template === 'tmpl-modern') {
                cv.innerHTML = `
                    <div class="cv-content">
                        <div class="sidebar-col">
                            ${photoHTML}
                            <h2>${labels.contact}</h2>
                            <div class="contact-info">
                                <div><i class="fas fa-envelope"></i> ${data.email}</div>
                                <div><i class="fas fa-phone"></i> ${data.phone}</div>
                                <div><i class="fas fa-map-marker-alt"></i> ${data.address}</div>
                            </div>
                            <h2>${labels.skills}</h2>
                            <div style="display:flex; flex-wrap:wrap; gap:5px; color:#333;">${skillsHTML}</div>
                        </div>
                        <div class="main-col">
                            <div class="main-header">
                                <h1>${data.name}</h1>
                                <div class="job-title">${data.jobTitle}</div>
                            </div>
                            <p style="margin-bottom:30px; line-height:1.6;">${data.summary}</p>
                            <div class="section-head"><i class="fas fa-briefcase"></i> ${labels.exp}</div>
                            ${renderEntries(data.experience)}
                            <div class="section-head"><i class="fas fa-graduation-cap"></i> ${labels.edu}</div>
                            ${renderEntries(data.education)}
                        </div>
                    </div>`;
            } else if (config.template === 'tmpl-classic') {
                cv.innerHTML = `
                    <div class="cv-content">
                        <div class="header">
                            <h1>${data.name}</h1>
                            <div class="job-title">${data.jobTitle}</div>
                            <div class="contacts"><span>${data.email}</span> | <span>${data.phone}</span> | <span>${data.address}</span></div>
                        </div>
                        ${data.summary ? `<h3>${labels.profile}</h3><p>${data.summary}</p>` : ''}
                        <h3>${labels.exp}</h3>${renderEntriesGrid(data.experience)}
                        <h3>${labels.edu}</h3>${renderEntriesGrid(data.education)}
                        <h3>${labels.skills}</h3><div>${skillsHTML}</div>
                    </div>`;
            } else if (config.template === 'tmpl-creative') {
                cv.innerHTML = `
                    <div class="cv-content">
                        <div class="header">
                            <div><h1>${data.name}</h1><div class="job-title">${data.jobTitle}</div></div>
                            <div class="contacts">
                                <div>${data.email} <i class="fas fa-envelope" style="color:var(--theme-color)"></i></div>
                                <div>${data.phone} <i class="fas fa-phone" style="color:var(--theme-color)"></i></div>
                                <div>${data.address} <i class="fas fa-map-marker-alt" style="color:var(--theme-color)"></i></div>
                            </div>
                        </div>
                        <div class="grid-layout">
                            <div class="main-side">
                                <h3>${labels.profile}</h3><p style="margin-bottom:30px;">${data.summary}</p>
                                <h3>${labels.exp}</h3>${renderEntries(data.experience)}
                                <h3>${labels.edu}</h3>${renderEntries(data.education)}
                            </div>
                            <div class="side-bar">
                                ${data.photo ? `<img src="${data.photo}" style="width:100%; margin-bottom:20px; border-radius:8px;">` : ''}
                                <h3>${labels.skills}</h3>${skillsHTML}
                            </div>
                        </div>
                    </div>`;
            }
        }

        function renderEntries(list) {
            return list.map(item => `
                <div class="entry">
                    <div class="entry-sub"><span>${item.subtitle}</span><span>${item.date}</span></div>
                    <div class="entry-title">${item.title}</div>
                    <p>${item.desc.replace(/\n/g, '<br>')}</p>
                </div>`).join('');
        }
        function renderEntriesGrid(list) {
            return list.map(item => `
                <div class="entry">
                    <div class="date-col">${item.date}</div>
                    <div class="main-col"><h4>${item.title}</h4><div class="sub">${item.subtitle}</div><p>${item.desc}</p></div>
                </div>`).join('');
        }
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            // Find the correct button to activate based on the target tabId
            document.querySelectorAll('.tabs-nav .tab-btn').forEach(btn => {
                const btnText = btn.innerText.toLowerCase();
                if (
                    (tabId === 'design' && (btnText.includes('design') || btnText.includes('التصميم'))) ||
                    (tabId === 'info' && (btnText.includes('data') || btnText.includes('البيانات'))) ||
                    (tabId === 'exp' && (btnText.includes('exp') || btnText.includes('الخبرات'))) ||
                    (tabId === 'skills' && (btnText.includes('skills') || btnText.includes('المهارات'))) ||
                    (tabId === 'settings' && (btnText.includes('settings') || btnText.includes('الإعدادات')))
                ) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.tab-pane').forEach(p => p.style.display = 'none');
            document.getElementById(`tab-${tabId}`).style.display = 'block';
        }
        function downloadPDF() { window.print(); }
        function resetData() { 
            if(confirm(translations[state.config.lang].btn_reset + '?')) { 
                state = JSON.parse(JSON.stringify(defaultState)); 
                renderAll(); 
                saveAndRender(); 
                updateInterfaceText(state.config.lang);
            } 
        }
        function loadSample() {
            state.data = {
                name: 'عبدالله العتيبي', jobTitle: 'مدير مشاريع', email: 'user@example.com', phone: '0551234567', address: 'الرياض',
                summary: 'مدير مشاريع محترف مع خبرة واسعة في إدارة فرق العمل.', photo: null, skills: 'تخطيط, إدارة, تواصل, لغة إنجليزية',
                experience: [{ id: 1, title: 'مدير مشروع', subtitle: 'شركة أرامكو', date: '2020 - الحالي', desc: 'إدارة مشاريع بقيمة 5 مليون ريال.' }],
                education: [{ id: 2, title: 'ماجستير إدارة', subtitle: 'جامعة الملك سعود', date: '2019', desc: 'تخرج بامتياز.' }]
            };
            state.config.lang = 'ar';
            renderAll(); 
            saveAndRender();
            updateInterfaceText(state.config.lang);
        }
    </script>
</body>
</html>

